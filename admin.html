<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>

<!-- ======= STYLES ======= -->
<style>
    body {
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
        display: flex;
        background: #eef1ff;
    }

    /* ==== SIDEBAR ==== */
    .sidebar {
        width: 250px;
        background: linear-gradient(180deg, #4c51bf, #6b73ff);
        color: #fff;
        height: 100vh;
        position: fixed;
        padding-top: 20px;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }

    .sidebar h2 {
        text-align: center;
        margin-bottom: 30px;
    }

    .sidebar a {
        display: block;
        padding: 15px;
        color: #fff;
        text-decoration: none;
        font-weight: bold;
        transition: 0.3s;
    }

    .sidebar a:hover {
        background: rgba(255,255,255,0.2);
        border-left: 5px solid yellow;
    }

    /* ==== MAIN CONTENT ==== */
    .main {
        margin-left: 260px;
        padding: 30px;
        width: calc(100% - 250px);
    }

    .topbar {
        background: #fff;
        padding: 15px;
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        font-weight: bold;
    }

    /* ==== STUDENT TABLE ==== */
    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        margin-top: 20px;
        border-radius: 10px;
        overflow: hidden;
    }

    th, td {
        padding: 12px 15px;
        text-align: center;
        border-bottom: 1px solid #ddd;
    }

    th {
        background: #4c51bf;
        color: white;
    }

    tr:hover {
        background-color: #e6e9ff;
    }

    /* ==== BUTTONS ==== */
    .btn-edit, .btn-delete {
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        border: none;
        font-weight: bold;
    }

    .btn-edit {
        background-color: #4c51bf;
        color: white;
    }

    .btn-edit:hover {
        background-color: #28307a;
    }

    .btn-delete {
        background-color: crimson;
        color: white;
    }

    .btn-delete:hover {
        background-color: darkred;
    }

    /* ==== EDIT POPUP FORM ==== */
    .editPopup {
        display: none;
        position: fixed;
        left: 0; top: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        justify-content: center; align-items: center;
        z-index: 1000;
    }

    .editPopupForm {
        background: white;
        padding: 20px;
        border-radius: 10px;
        width: 400px;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
        animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes fadeIn {
        from {opacity: 0; transform: scale(0.8)}
        to {opacity: 1; transform: scale(1)}
    }

    .editPopupForm input {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border-radius: 6px;
        border: 1px solid gray;
    }

    .save-btn {
        background: #4c51bf;
        color: white;
        padding: 8px 14px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
    }

    .save-btn:hover { background:#28307a; }

    .close-btn {
        background: crimson;
        color: white;
        padding: 8px 14px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
    }

    .close-btn:hover { background: darkred; }

    /* ==== MOBILE RESPONSIVE ==== */
    @media(max-width:768px) {
        .sidebar { width: 180px; }
        .main { margin-left: 190px; width: calc(100% - 180px); }
        .editPopupForm { width: 90%; }
        th, td { font-size: 13px; }
    }

    @media(max-width:500px) {
        body { flex-direction: column; }
        .sidebar { width: 100%; height: auto; position: relative; }
        .main { margin-left: 0; width: 100%; }
        table { font-size: 12px; }
    }
</style>

<script type="module">

/* ======== IMPORT FIREBASE ======== */
import { db } from "./firebase.js";
import { collection, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

const studentsTable = document.getElementById("students-body");

/* ======== DISPLAY STUDENTS ======== */
async function fetchStudents() {
    const querySnapshot = await getDocs(collection(db, "students"));
    studentsTable.innerHTML = "";
    querySnapshot.forEach((studentDoc) => {
        const student = studentDoc.data();
        const row = `
            <tr>
                <td>${student.fullName}</td>
                <td>${student.schoolId}</td>
                <td>${student.program}</td>
                <td>${student.email}</td>
                <td>
                    <button class="btn-edit" onclick="editStudent('${studentDoc.id}', '${student.fullName}', '${student.schoolId}', '${student.program}', '${student.email}')">Edit</button>
                    <button class="btn-delete" onclick="deleteStudent('${studentDoc.id}')">Delete</button>
                </td>
            </tr>
        `;
        studentsTable.innerHTML += row;
    });
}
fetchStudents();

/* ======== DELETE STUDENT ======== */
window.deleteStudent = async(id) => {
    if(confirm("Are you sure you want to delete this student?")) {
        await deleteDoc(doc(db, "students", id));
        alert("Student deleted.");
        fetchStudents();
    }
}

/* ======== EDIT STUDENT POPUP ======== */
window.editStudent = (id, name, sid, prog, email) => {
    document.getElementById("editId").value = id;
    document.getElementById("editName").value = name;
    document.getElementById("editSID").value = sid;
    document.getElementById("editProgram").value = prog;
    document.getElementById("editEmail").value = email;
    document.querySelector(".editPopup").style.display = "flex";
};

/* ======== SAVE EDIT ======== */
window.saveEdit = async() => {
    const id = document.getElementById("editId").value;
    await updateDoc(doc(db, "students", id), {
        fullName: document.getElementById("editName").value,
        schoolId: document.getElementById("editSID").value,
        program: document.getElementById("editProgram").value,
        email: document.getElementById("editEmail").value,
    });
    alert("Student updated successfully!");
    document.querySelector(".editPopup").style.display = "none";
    fetchStudents();
}

function closePopup() { document.querySelector(".editPopup").style.display = "none"; }
window.closePopup = closePopup;

</script>
</head>

<body>

<!-- ======== SIDEBAR ======== -->
<div class="sidebar">
    <h2>ADMIN PANEL</h2>
    <a href="#">Dashboard</a>
    <a href="#">Students</a>
    <a href="#">Settings</a>
    <a href="#" style="color:yellow;">Logout</a>
</div>

<!-- ======== MAIN SECTION ======== -->
<div class="main">
    <div class="topbar">Student Management Dashboard</div>

    <table>
        <thead>
            <tr>
                <th>Full Name</th>
                <th>School ID</th>
                <th>Program</th>
                <th>Email</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="students-body"></tbody>
    </table>
</div>

<!-- ======== EDIT FORM POPUP ======== -->
<div class="editPopup">
    <div class="editPopupForm">
        <h3>Edit Student</h3>

        <input type="hidden" id="editId">
        <input type="text" id="editName" placeholder="Full Name">
        <input type="text" id="editSID" placeholder="School ID">
        <input type="text" id="editProgram" placeholder="Program">
        <input type="email" id="editEmail" placeholder="Email">

        <button class="save-btn" onclick="saveEdit()">Save</button>
        <button class="close-btn" onclick="closePopup()">Cancel</button>
    </div>
</div>

</body>
</html>